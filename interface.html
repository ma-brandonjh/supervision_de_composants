<!doctype html>
<html>
    <head>
        <title>Interface</title>
        <link rel="stylesheet" href="interface.css">
        <meta http-equiv="refresh" content="5">
    </head>
    <body>
        <header>
            <h1>Bienvenue --- Interface de contrôle des iots</h1>
        </header>
        <main>
            <div class="diva">
            <h2>Journal des dernières mesures</h2><br>
                <div class="divc" id="table-container"></div>
            </div>
            <hr>
            <div class="diva">
            <h2>État des LEDs</h2>
            <h3>LED de la chambre:</h3>
                <h4>allumée</h4>
            <h3>LED du salon:</h3>
                <h4>éteinte</h4>
            <h3>LED de la cuisine:</h3>
                <h4>éteinte</h4>
            <ul>
                <li><button>Rafraichir</button></li>
            </ul>
            </div>
            <hr>
            <div class="diva">
            <h2>Contrôle des LEDs</h2>
        <div class="divb">
            <h3>Chambre</h3>
                <button onclick="envoyerCommande('chambre/on')">ON</button>
                <button onclick="envoyerCommande('chambre/off')">OFF</button>
        </div>
        <div class="divb">
            <h3>Salon</h3>
                <button onclick="envoyerCommande('salon/on')">ON</button>
                <button onclick="envoyerCommande('salon/off')">OFF</button>
        </div>
        <div class="divb">
            <h3>Cuisine</h3>
                <button onclick="envoyerCommande('cuisine/on')">ON</button>
                <button onclick="envoyerCommande('cuisine/off')">OFF</button>
        </div>
            </div>
        </main>
        <nav></nav>
        <footer></footer>
    </body>

    <script>
        const data = [ //pour generateTable
            {"time":"13 mai 2025 22h35", "température":12.4, "humidité":56},
            {"time":"13 mai 2025 22h35", "température":12.4, "humidité":56}
        ]

        function envoyerCommande(etat) {
            fetch('/led', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ led: etat }) // {"led": "chambre/on"} ou {"led": "salon/off"}
            })
            console.log(body)
            .then(res => res.text())
            .then(data => console.log("Réponse:", data))
            .catch(err => console.error("Erreur:", err));
        }


        function generateTable(data){
            const container = document.getElementById("table-container")

            if (data.length===0){
                container.innerHTML = "<p> Aucune donnée.</p>";
                return;
            }

            const table = document.createElement("table");
            const thead = document.createElement("thead");
            const tbody = document.createElement("tbody");

            // En tête
            const headers = Object.keys(data[0]);
            const headerRow = document.createElement("tr");
            headers.forEach(key =>{
                const th = document.createElement("th");
                th.textContent = key;
                headerRow.appendChild(th);
            });

            // Créer les lignes du tableau
            data.forEach(item => {
            const row = document.createElement("tr");
            headers.forEach(key => {
                const td = document.createElement("td");
                td.textContent = item[key];
                row.appendChild(td);
            });
            tbody.appendChild(row);
            });

            table.appendChild(thead);
            table.appendChild(tbody);
            container.appendChild(table);
        }

  generateTable(data);

    </script>


</html>