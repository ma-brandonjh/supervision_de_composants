<!doctype html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <title>Interface</title>
        <meta http-equiv="refresh" content="5">
        <link rel="stylesheet" href="./../index.css">
                <style>
            *{
    padding:0px;
    margin:0px;
}

header{
    background-color: aquamarine;
    padding:2%;
}

header ul{
    display:flex;
    align-content:center;
}

header ul li{
    margin:5px;
}

ul{
    display:flex;
    text-decoration: none;
    text-decoration-style: none;
}

li{
    text-decoration: none;
    text-decoration-style: none;   
}


main{
    display:flex;
    align-items: flex-start;
    margin:2%;
}

.divb{
    border-radius:8px;
    border:2px solid;
    padding:2%;
    margin:2%;
    width: 150px;
    background-color: rgb(207, 207, 207);
}

.diva{
    display:flex;
    flex-direction: column;
    align-items:center;
    border-radius:8px;
    border:2px solid;
    padding:2%;
    margin:1%;
    width:40%;
    background-color: rgba(139, 255, 255, 0.377);
}

h1{
    display:flex;
    justify-content:center;
}

.diva table{
    border-radius: 8px;
    padding:1%;
}

h3{
    text-decoration: underline;
    margin-top:8px;
}

h4{
    margin-bottom:8px;
}

.divc{
    background-color: white;
}

header ul li button{
    width:200px;
}

header ul {
    display:flex;
    justify-content: center;
}

ul{
    list-style-type:none;
}

header ul li button a{
    text-decoration: none;
    color:black;
}


button{
    border-radius: 8px;
    padding-top:5px;
    padding-bottom:5px;
    padding-left:10px;
    padding-right:10px;
    border-color:black;
    margin:2%;
}

table{
    border:solid;
}

th{
    border:solid;
    padding:1%;
}

footer{
    display:flex;
    justify-content:center;
    align-content:center;
}

button:hover{
    background-color: rgb(151, 248, 248);
    border-color:red;
}

.center{
    display:flex;
    justify-content:center;
}
        </style>
    </head>
    <body>
        <header>
            <h1>Tableau de bord --- Interface de contrôle des iots</h1>
            <ul>
                <li><a href="/"><button>Accueil</button></a></li>
                <li><a href="/mesure"><button>Température et humidité</button></a></li>
                <li><a href="/led-state"><button>États des LEDs</button></a></li>
                <li><a href="/led-cmd"><button>Contrôle des LEDs</button></a></li>
            </ul>
        </header>

<hr>

        <main>
            <div class="diva">
            <h2>Journal des dernières mesures</h2><br>
                <div class="divc" id="table-container"></div>
                            <ul>
                <li><button onclick="rafraichirTable()">Rafraichir</button></li>
            </ul>
            </div>
            <hr>
            <div class="diva">
            <h2>État des LEDs</h2>
            <h3>LED de la chambre:</h3>
                <h4 id="etat-chambre">allumée</h4>
            <h3>LED du salon:</h3>
                <h4 id="etat-salon">éteinte</h4>
            <h3>LED de la cuisine:</h3>
                <h4 id="etat-cuisine">éteinte</h4>
            <ul>
                <li><button onclick="rafraichirJSON()">Rafraichir</button></li>
            </ul>
            </div>
            <hr>
            <div class="diva">
            <h2>Contrôle des LEDs</h2>
        <div class="divb">
            <h3>Chambre</h3>
                <button onclick="envoyerCommande('chambre/on')">ON</button>
                <button onclick="envoyerCommande('chambre/off')">OFF</button>
        </div>
        <div class="divb">
            <h3>Salon</h3>
                <button onclick="envoyerCommande('salon/on')">ON</button>
                <button onclick="envoyerCommande('salon/off')">OFF</button>
        </div>
        <div class="divb">
            <h3>Cuisine</h3>
                <button onclick="envoyerCommande('cuisine/on')">ON</button>
                <button onclick="envoyerCommande('cuisine/off')">OFF</button>
        </div>
            </div>
        </main>
        <nav></nav>



    <script>
        const data = [ //pour generateTable
            {"time":"13 mai 2025 22h35", "température":20, "humidité":56},
            {"time":"13 mai 2025 22h35", "température":12.4, "humidité":56},
            {"time":"13 mai 2025 22h35", "température":12.4, "humidité":56}
        ]

        function envoyerCommande(commande) {
  fetch('/led', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ led: commande })
  })
  .then(res => {
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    return res.text();
  })
  .then(txt => console.log('Réponse du serveur :', txt))
  .catch(err => console.error('Erreur POST :', err));
}




        function generateTable(data){
            const container = document.getElementById("table-container")

            if (data.length===0){
                container.innerHTML = "<p> Aucune donnée.</p>";
                return;
            }

            const table = document.createElement("table");
            const thead = document.createElement("thead");
            const tbody = document.createElement("tbody");

            // En tête
            const headers = ['Time', 'Température', 'Humidité'];
            const headerRow = document.createElement("tr");
            headers.forEach(key =>{
                const th = document.createElement("th");
                th.textContent = key;
                headerRow.appendChild(th);
            });

            // Créer les lignes du tableau
            data.forEach(item => {
            const row = document.createElement("tr");
            headers.forEach(key => {
                const td = document.createElement("td");
                td.textContent = item[key];
                row.appendChild(td);
            });
            tbody.appendChild(row);
            });

            table.appendChild(thead);
            table.appendChild(tbody);
            container.appendChild(table);
        }

  generateTable(data);

    </script>

<script>
  function rafraichirJSON() {
    const pièces = ["chambre", "salon", "cuisine"];
    const états = {};

    pièces.forEach(p => {
      const état = Math.random() < 0.5 ? "off" : "on";
      états[p] = état;

      // Mise à jour dans le HTML (on → allumée, off → éteinte)
      const texte = état === "on" ? "allumée" : "éteinte";
      const id = "etat-" + p;
      const element = document.getElementById(id);
      if (element) {
        element.textContent = texte;
      }
    });

    // (Optionnel) Affichage console
    console.log(états);
  }
</script>

<script>

    /* ---------- fait l’appel AJAX ---------- */
    function loadData(endpoint) {
      fetch(endpoint)
        .then(r => {
          if (!r.ok) throw new Error(`${r.status} ${r.statusText}`);
          return r.json();
        })
        .then(data => {
          /* ta fonction utilitaire déjà écrite */
          generateTable(data);
        })
        .catch(err => console.error('Erreur de chargement :', err));
    }
  </script>
<script>
function rafraichirTable(){
    const data = randomData();
    generateTable(data);
}

/* ----------- 1) Génère un tableau aléatoire (0-15 entrées) ---------- */
function randomData() {
  const n = Math.floor(Math.random() * 16);            // 0-15 éléments
  const maintenant = Date.now();
  const unJour = 24 * 60 * 60 * 1000;

  const arr = [];
  for (let i = 0; i < n; i++) {
    // Date aléatoire dans les 365 derniers jours
    const offset = Math.floor(Math.random() * 365) * unJour;
    const d = new Date(maintenant - offset);

    // Format "DD MMM YYYY HHhMM" (ex. 13 mai 2025 22h35)
    const fmt = d.toLocaleDateString('fr-FR', { day:'2-digit', month:'short', year:'numeric' })
               + ' ' +
               d.toLocaleTimeString('fr-FR', { hour:'2-digit', minute:'2-digit' }).replace(':', 'h');

    arr.push({
      date: fmt,
      température: (Math.random() * 55 - 20).toFixed(1),   // -20 → +35
      humidité: Math.floor(Math.random() * 101)            // 0 → 100
    });
  }
  return arr;
}

/* ----------- 2) Construit le tableau (max 10 lignes) ---------------- */
function generateTable(data) {
  const container = document.getElementById("table-container");
  container.innerHTML = '';                        // réinitialiser

  if (!data.length) {
    container.textContent = "Aucune donnée.";
    return;
  }

  const table  = document.createElement("table");
  const thead  = document.createElement("thead");
  const tbody  = document.createElement("tbody");

  // En-têtes
  const headers = ['Date', 'Température (°C)', 'Humidité (%)'];
  const headerRow = document.createElement("tr");
  headers.forEach(label => {
    const th = document.createElement("th");
    th.textContent = label;
    headerRow.appendChild(th);
  });
  thead.appendChild(headerRow);

  // Corps (au plus 10 lignes)
  data.slice(0, 10).forEach(item => {
    const tr = document.createElement("tr");

    // Date
    const tdDate = document.createElement("td");
    tdDate.textContent = item.date;
    tr.appendChild(tdDate);

    // Température + unité
    const tdTemp = document.createElement("td");
    tdTemp.textContent = `${item.température} °C`;
    tr.appendChild(tdTemp);

    // Humidité + unité
    const tdHum  = document.createElement("td");
    tdHum.textContent = `${item.humidité} %`;
    tr.appendChild(tdHum);

    tbody.appendChild(tr);
  });

  table.appendChild(thead);
  table.appendChild(tbody);
  container.appendChild(table);
}

</script>

    </body>
</html>