<!doctype html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <title>Interface</title>
        <meta http-equiv="refresh" content="5">
        <link rel="stylesheet" href="./../index.css">
                <style>
            *{
    padding:0px;
    margin:0px;
}

header{
    background-color: aquamarine;
    padding:2%;
}

header ul{
    display:flex;
    align-content:center;
}

header ul li{
    margin:5px;
}

ul{
    display:flex;
    text-decoration: none;
    text-decoration-style: none;
}

li{
    text-decoration: none;
    text-decoration-style: none;   
}


main{
    display:flex;
    align-items: flex-start;
    margin:2%;
}

.divb{
    border-radius:8px;
    border:2px solid;
    padding:2%;
    margin:2%;
    width: 150px;
    background-color: rgb(207, 207, 207);
}

.diva{
    display:flex;
    flex-direction: column;
    align-items:center;
    border-radius:8px;
    border:2px solid;
    padding:2%;
    margin:1%;
    width:40%;
    background-color: rgba(139, 255, 255, 0.377);
}

h1{
    display:flex;
    justify-content:center;
}

.diva table{
    border-radius: 8px;
    padding:1%;
}

h3{
    text-decoration: underline;
    margin-top:8px;
}

h4{
    margin-bottom:8px;
}

.divc{
    background-color: white;
}

header ul li button{
    width:200px;
}

header ul {
    display:flex;
    justify-content: center;
}

ul{
    list-style-type:none;
}

header ul li button a{
    text-decoration: none;
    color:black;
}


button{
    border-radius: 8px;
    padding-top:5px;
    padding-bottom:5px;
    padding-left:10px;
    padding-right:10px;
    border-color:black;
    margin:2%;
}

table{
    border:solid;
}

th{
    border:solid;
    padding:1%;
}

footer{
    display:flex;
    justify-content:center;
    align-content:center;
}

button:hover{
    background-color: rgb(151, 248, 248);
    border-color:red;
}
        </style>
    </head>
    <body>
        <header>
            <h1>Tableau de bord --- Interface de contrôle des iots</h1>
            <ul>
                <li><button><a href="/">Accueil</a></button></li>
                <li><button><a href="/mesure">Température et humidité</a></button></li>
                <li><button><a href="/led-cmd">Contrôle des LEDs</a></button></li>
                <li><button><a href="/led-state">États des LEDs</a></button></li>
            </ul>
        </header>

<hr>

        <main>
            <div class="diva">
            <h2>Journal des dernières mesures</h2><br>
                <div class="divc" id="table-container"></div>
            </div>
            <hr>
            <div class="diva">
            <h2>État des LEDs</h2>
            <h3>LED de la chambre:</h3>
                <h4>allumée</h4>
            <h3>LED du salon:</h3>
                <h4>éteinte</h4>
            <h3>LED de la cuisine:</h3>
                <h4>éteinte</h4>
            <ul>
                <li><button>Rafraichir</button></li>
            </ul>
            </div>
            <hr>
            <div class="diva">
            <h2>Contrôle des LEDs</h2>
        <div class="divb">
            <h3>Chambre</h3>
                <button onclick="envoyerCommande('chambre/on')">ON</button>
                <button onclick="envoyerCommande('chambre/off')">OFF</button>
        </div>
        <div class="divb">
            <h3>Salon</h3>
                <button onclick="envoyerCommande('salon/on')">ON</button>
                <button onclick="envoyerCommande('salon/off')">OFF</button>
        </div>
        <div class="divb">
            <h3>Cuisine</h3>
                <button onclick="envoyerCommande('cuisine/on')">ON</button>
                <button onclick="envoyerCommande('cuisine/off')">OFF</button>
        </div>
            </div>
        </main>
        <nav></nav>

<hr>

        <footer>
            <h4>Développement uniquement:</h4>
            <button>Get DHT11 data</button>
            <button>Test 2</button>
            <button>Test 3</button>
            <form action="/led" method="POST">
            <input type="hidden" name="led" value="rouge">
            <input type="hidden" name="etat" value="on">
            <button type="submit">Allumer</button>
            <button onclick="getStatus()">Obtenir le status des IoTs</button>
            </form>
        </footer>
    </body>

    <script>
        const data = [ //pour generateTable
            {"time":"13 mai 2025 22h35", "température":12.4, "humidité":56},
            {"time":"13 mai 2025 22h35", "température":12.4, "humidité":56}
        ]

        function envoyerCommande(commande) {
  fetch('/led', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ led: commande })
  })
  .then(res => {
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    return res.text();
  })
  .then(txt => console.log('Réponse du serveur :', txt))
  .catch(err => console.error('Erreur POST :', err));
}




        function generateTable(data){
            const container = document.getElementById("table-container")

            if (data.length===0){
                container.innerHTML = "<p> Aucune donnée.</p>";
                return;
            }

            const table = document.createElement("table");
            const thead = document.createElement("thead");
            const tbody = document.createElement("tbody");

            // En tête
            const headers = Object.keys(data[0]);
            const headerRow = document.createElement("tr");
            headers.forEach(key =>{
                const th = document.createElement("th");
                th.textContent = key;
                headerRow.appendChild(th);
            });

            // Créer les lignes du tableau
            data.forEach(item => {
            const row = document.createElement("tr");
            headers.forEach(key => {
                const td = document.createElement("td");
                td.textContent = item[key];
                row.appendChild(td);
            });
            tbody.appendChild(row);
            });

            table.appendChild(thead);
            table.appendChild(tbody);
            container.appendChild(table);
        }

  generateTable(data);

    </script>

<script>
function envoyerCommande(commande) {
    fetch('/led', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ led: commande })
    })
    .then(res => res.text())
    .then(data => console.log("Réponse du serveur :", data))
    .catch(err => console.error("Erreur :", err));
}
</script>
<script>
    function getStatus() {
      fetch('localhost:3000')
        .then(response => response.json())
        .then(data => {
          document.getElementById('resultat').innerText = JSON.stringify(data, null, 2);
        })
        .catch(error => {
          console.error('Erreur :', error);
          document.getElementById('resultat').innerText = 'Erreur lors de la requête';
        });
    }
</script>
</html>